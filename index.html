<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Register View — UID Submit + Auto Predictions</title>
<style>
:root{
  --accent:#0b84ff;
  --gold:#ffd37a;
  --bg:#071127;
  --muted:rgba(255,255,255,0.06);
  color-scheme: dark;
  font-family: Inter, Arial, Helvetica, sans-serif;
}
html,body{height:100%;margin:0;background:linear-gradient(180deg,#041024,#071127);color:#eaf3ff}
iframe{width:100%;height:100vh;border:0;display:block}
#topMiddleBox {
  position: fixed; top: 14px; left: 50%; transform: translateX(-50%);
  padding: 12px 22px; border-radius: 14px;
  background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.015));
  border: 1px solid rgba(255,255,255,0.08);
  box-shadow: 0 8px 36px rgba(2,6,23,0.7), 0 0 18px rgba(11,132,255,0.06) inset;
  color: #ffffff; font-weight: 800; font-size: 15px; letter-spacing: 0.6px;
  z-index: 10000; cursor: pointer; display: flex; gap:10px; align-items:center;
}
#topMiddleBox .dot{
  width:10px;height:10px;border-radius:50%;
  background: linear-gradient(90deg,#ffd37a,#ff9f1c);
  box-shadow:0 0 12px rgba(255,159,28,0.5);
}
#topMiddleBox .label{font-size:14px;color:#f8fbff}
#uidModal {
  display:none; position:fixed; left:50%; top:50%; transform:translate(-50%,-50%);
  z-index:10001; background:linear-gradient(180deg,#071528,#031422);
  padding:20px; border-radius:12px; width:min(460px,92%);
  border:1px solid rgba(255,255,255,0.04); box-shadow:0 28px 80px rgba(2,6,23,0.7);
  color:#eaf3ff;
}
#uidModal h3{margin:0 0 8px;color:var(--gold);font-weight:900;font-size:18px}
#uidModal p{margin:0 0 12px;color:#bfe8ff;font-size:13px}
#uidInput {
  width:100%; padding:12px; border-radius:10px;
  border:1px solid var(--muted);
  background:rgba(255,255,255,0.02); color:#eaf3ff;
  font-weight:700; font-size:14px; box-sizing:border-box;
}
.row{display:flex;gap:10px;margin-top:12px;justify-content:center}
.btn{
  padding:10px 14px;border-radius:10px;border:0;cursor:pointer;
  font-weight:900;color:#fff;background:linear-gradient(180deg,var(--accent),#0661d9)
}
.btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:#cfe8ff}
.toast{position:fixed;right:12px;top:12px;padding:8px 12px;border-radius:8px;color:#fff;z-index:10002}
#predictionBox {
  display:none; position:fixed; right:12px; top:60px; width:320px; max-width:90%;
  background:linear-gradient(180deg,#071528,#031422);
  border:1px solid rgba(255,255,255,0.04); padding:14px; border-radius:10px;
  z-index:10000; color:#dfefff; font-weight:800;
}
#bigSmallBox{
  position:fixed;bottom:18px;left:50%;transform:translateX(-50%);
  display:none;padding:8px 14px;border-radius:10px;
  font-weight:900;background:#fff;color:#000;z-index:10000;
}
</style>
</head>
<body>
  <div id="topMiddleBox" title="Owner access — click to unlock">
    <div class="dot" id="lockDot"></div>
    <div class="label" id="topLabel">Enter UID</div>
  </div>

  <iframe id="gameFrame" src="https://bhtclub0.com/#/register?invitationCode=812626253940" title="Registration"></iframe>

  <div id="uidModal" role="dialog" aria-modal="true" aria-labelledby="uidTitle">
    <h3 id="uidTitle">Enter UID</h3>
    <p>Please enter your UID to enable automatic predictions.</p>
    <input id="uidInput" type="text" placeholder="Enter UID" autocomplete="off" />
    <div class="row">
      <button id="uidSubmit" class="btn">Submit</button>
      <button id="uidCancel" class="btn ghost">Cancel</button>
    </div>
  </div>

  <div id="predictionBox">
    <div style="font-size:14px;color:var(--gold);margin-bottom:8px">Predictions (User)</div>
    <div id="predictionContent" style="font-size:13px;color:#e6f7ff">No prediction yet.</div>
  </div>

  <div id="bigSmallBox">BIG</div>

  <!-- Firebase Script -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBdcYuIyTk2qNvabTW15fZoWwzrKpXveu4",
      authDomain: "king-predictor-a24e6.firebaseapp.com",
      databaseURL: "https://king-predictor-a24e6-default-rtdb.firebaseio.com",
      projectId: "king-predictor-a24e6",
      storageBucket: "king-predictor-a24e6.firebasestorage.app",
      messagingSenderId: "156995492169",
      appId: "1:156995492169:web:e327c7b36706550bb3a298"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const topBox = document.getElementById('topMiddleBox');
    const lockDot = document.getElementById('lockDot');
    const topLabel = document.getElementById('topLabel');
    const uidModal = document.getElementById('uidModal');
    const uidInput = document.getElementById('uidInput');
    const uidSubmit = document.getElementById('uidSubmit');
    const uidCancel = document.getElementById('uidCancel');
    const predictionBox = document.getElementById('predictionBox');
    const predictionContent = document.getElementById('predictionContent');
    const bigSmallBox = document.getElementById('bigSmallBox');

    let uidSaved = null;
    let minuteTimerHandle = null;

    topBox.addEventListener('click', () => {
      uidInput.value = '';
      uidModal.style.display = 'block';
      uidInput.focus();
    });

    uidCancel.addEventListener('click', () => {
      uidModal.style.display = 'none';
    });

    uidSubmit.addEventListener('click', () => {
      const val = uidInput.value.trim();
      if (!val) { showToast('Please enter UID', false); return; }
      uidSaved = val;
      uidModal.style.display = 'none';
      const userRef = ref(db, 'uids/' + val);
      set(userRef, {
        uid: val,
        status: "pending",
        timestamp: Date.now()
      });
      statusWait();
      onValue(userRef, (snapshot) => {
        const data = snapshot.val();
        if (data) {
          if (data.status === "approved") {
            statusApproved();
          } else if (data.status === "rejected") {
            statusRejected();
          } else {
            statusWait();
          }
        }
      });
    });

    function statusWait() {
      showToast("⏳ Wait for admin approval...", false);
      topLabel.textContent = "Waiting for approval...";
      predictionBox.style.display = "none";
      bigSmallBox.style.display = "none";
    }

    function statusApproved() {
      showToast("✅ Approved! Prediction started...", true);
      topLabel.textContent = "UID: " + uidSaved;
      predictionBox.style.display = "block";
      bigSmallBox.style.display = "block";
      startAutoPredictionAndBigSmall();
    }

    function statusRejected() {
      showToast("❌ Rejected by admin", false);
      topLabel.textContent = "Rejected";
      predictionBox.style.display = "none";
      bigSmallBox.style.display = "none";
      stopPrediction();
    }

    function startAutoPredictionAndBigSmall() {
      stopPrediction();
      showPrediction();
      showBigSmall();
      const now = new Date();
      const msToNext = (60 - now.getSeconds()) * 1000 - now.getMilliseconds();
      setTimeout(() => {
        showPrediction(); showBigSmall();
        minuteTimerHandle = setInterval(() => {
          showPrediction(); showBigSmall();
        }, 60000);
      }, msToNext);
    }

    function stopPrediction() {
      clearInterval(minuteTimerHandle);
      minuteTimerHandle = null;
    }

    function showPrediction() {
      const samples = [
        'Prediction: Option A more likely.',
        'Prediction: Wait for 2 more draws.',
        'Prediction: High confidence on number 7.',
        'Prediction: No strong signal today.',
        'Prediction: Play cautiously — low confidence.'
      ];
      const p = samples[Math.floor(Math.random() * samples.length)];
      predictionContent.textContent = p;
    }

    function showBigSmall() {
      const v = Math.random() < 0.5 ? 'BIG' : 'SMALL';
      bigSmallBox.textContent = v;
      bigSmallBox.style.background = v === 'BIG' ? '#d1fae5' : '#fee2e2';
      bigSmallBox.style.color = v === 'BIG' ? '#064e3b' : '#7f1d1d';
    }

    function showToast(msg, ok=true) {
      const el = document.createElement('div');
      el.className = 'toast';
      el.style.background = ok ? 'linear-gradient(90deg,#22c55e,#15803d)' : 'rgba(239,68,68,0.95)';
      el.textContent = msg;
      document.body.appendChild(el);
      setTimeout(() => el.remove(), 2400);
    }

    window.addEventListener('click', (e) => {
      if (e.target === uidModal) uidModal.style.display = 'none';
    });
  </script>
</body>
</html>
